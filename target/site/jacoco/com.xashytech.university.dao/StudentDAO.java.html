<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StudentDAO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Xashy Tech University Student Portal</a> &gt; <a href="index.source.html" class="el_package">com.xashytech.university.dao</a> &gt; <span class="el_source">StudentDAO.java</span></div><h1>StudentDAO.java</h1><pre class="source lang-java linenums">package com.xashytech.university.dao;

import com.xashytech.university.model.Student;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.support.GeneratedKeyHolder;
import org.springframework.jdbc.support.KeyHolder;
import org.springframework.stereotype.Repository;

import java.sql.Date;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

/**
 * Student Data Access Object
 * Handles database operations for Student entities
 */
@Repository
<span class="nc" id="L22">public class StudentDAO {</span>

    @Autowired
    private JdbcTemplate jdbcTemplate;

    private static final String INSERT_STUDENT = 
        &quot;INSERT INTO students (student_id, first_name, last_name, email, phone_number, &quot; +
        &quot;date_of_birth, program, year, status, enrollment_date, gpa) &quot; +
        &quot;VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&quot;;

    private static final String SELECT_ALL_STUDENTS = 
        &quot;SELECT * FROM students ORDER BY last_name, first_name&quot;;

    private static final String SELECT_STUDENT_BY_ID = 
        &quot;SELECT * FROM students WHERE id = ?&quot;;

    private static final String SELECT_STUDENT_BY_STUDENT_ID = 
        &quot;SELECT * FROM students WHERE student_id = ?&quot;;

    private static final String SELECT_STUDENT_BY_EMAIL = 
        &quot;SELECT * FROM students WHERE email = ?&quot;;

    private static final String UPDATE_STUDENT = 
        &quot;UPDATE students SET student_id = ?, first_name = ?, last_name = ?, email = ?, &quot; +
        &quot;phone_number = ?, date_of_birth = ?, program = ?, year = ?, status = ?, gpa = ? &quot; +
        &quot;WHERE id = ?&quot;;

    private static final String DELETE_STUDENT = 
        &quot;DELETE FROM students WHERE id = ?&quot;;

    private static final String COUNT_STUDENTS = 
        &quot;SELECT COUNT(*) FROM students&quot;;

    /**
     * Save a new student to the database
     */
    public Student save(Student student) {
<span class="nc" id="L59">        KeyHolder keyHolder = new GeneratedKeyHolder();</span>
        
<span class="nc" id="L61">        jdbcTemplate.update(connection -&gt; {</span>
<span class="nc" id="L62">            PreparedStatement ps = connection.prepareStatement(INSERT_STUDENT, </span>
                new String[]{&quot;id&quot;});
<span class="nc" id="L64">            ps.setString(1, student.getStudentId());</span>
<span class="nc" id="L65">            ps.setString(2, student.getFirstName());</span>
<span class="nc" id="L66">            ps.setString(3, student.getLastName());</span>
<span class="nc" id="L67">            ps.setString(4, student.getEmail());</span>
<span class="nc" id="L68">            ps.setString(5, student.getPhoneNumber());</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">            ps.setDate(6, student.getDateOfBirth() != null ? </span>
<span class="nc" id="L70">                Date.valueOf(student.getDateOfBirth()) : null);</span>
<span class="nc" id="L71">            ps.setString(7, student.getProgram());</span>
<span class="nc" id="L72">            ps.setString(8, student.getYear());</span>
<span class="nc" id="L73">            ps.setString(9, student.getStatus());</span>
<span class="nc" id="L74">            ps.setDate(10, Date.valueOf(student.getEnrollmentDate()));</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">            ps.setDouble(11, student.getGpa() != null ? student.getGpa() : 0.0);</span>
<span class="nc" id="L76">            return ps;</span>
        }, keyHolder);

<span class="nc" id="L79">        Long generatedId = keyHolder.getKey().longValue();</span>
<span class="nc" id="L80">        student.setId(generatedId);</span>
<span class="nc" id="L81">        return student;</span>
    }

    /**
     * Find all students
     */
    public List&lt;Student&gt; findAll() {
<span class="nc" id="L88">        return jdbcTemplate.query(SELECT_ALL_STUDENTS, new StudentRowMapper());</span>
    }

    /**
     * Find student by ID
     */
    public Student findById(Long id) {
        try {
<span class="nc" id="L96">            return jdbcTemplate.queryForObject(SELECT_STUDENT_BY_ID, </span>
                new StudentRowMapper(), id);
<span class="nc" id="L98">        } catch (Exception e) {</span>
<span class="nc" id="L99">            return null;</span>
        }
    }

    /**
     * Find student by student ID
     */
    public Student findByStudentId(String studentId) {
        try {
<span class="nc" id="L108">            return jdbcTemplate.queryForObject(SELECT_STUDENT_BY_STUDENT_ID, </span>
                new StudentRowMapper(), studentId);
<span class="nc" id="L110">        } catch (Exception e) {</span>
<span class="nc" id="L111">            return null;</span>
        }
    }

    /**
     * Find student by email
     */
    public Student findByEmail(String email) {
        try {
<span class="nc" id="L120">            return jdbcTemplate.queryForObject(SELECT_STUDENT_BY_EMAIL, </span>
                new StudentRowMapper(), email);
<span class="nc" id="L122">        } catch (Exception e) {</span>
<span class="nc" id="L123">            return null;</span>
        }
    }

    /**
     * Update an existing student
     */
    public Student update(Student student) {
<span class="nc" id="L131">        int rowsAffected = jdbcTemplate.update(UPDATE_STUDENT,</span>
<span class="nc" id="L132">            student.getStudentId(),</span>
<span class="nc" id="L133">            student.getFirstName(),</span>
<span class="nc" id="L134">            student.getLastName(),</span>
<span class="nc" id="L135">            student.getEmail(),</span>
<span class="nc" id="L136">            student.getPhoneNumber(),</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">            student.getDateOfBirth() != null ? Date.valueOf(student.getDateOfBirth()) : null,</span>
<span class="nc" id="L138">            student.getProgram(),</span>
<span class="nc" id="L139">            student.getYear(),</span>
<span class="nc" id="L140">            student.getStatus(),</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">            student.getGpa() != null ? student.getGpa() : 0.0,</span>
<span class="nc" id="L142">            student.getId()</span>
        );

<span class="nc bnc" id="L145" title="All 2 branches missed.">        if (rowsAffected == 0) {</span>
<span class="nc" id="L146">            throw new RuntimeException(&quot;Failed to update student with ID: &quot; + student.getId());</span>
        }

<span class="nc" id="L149">        return student;</span>
    }

    /**
     * Delete student by ID
     */
    public boolean delete(Long id) {
<span class="nc" id="L156">        int rowsAffected = jdbcTemplate.update(DELETE_STUDENT, id);</span>
<span class="nc bnc" id="L157" title="All 2 branches missed.">        return rowsAffected &gt; 0;</span>
    }

    /**
     * Get total count of students
     */
    public int getStudentCount() {
<span class="nc" id="L164">        Integer count = jdbcTemplate.queryForObject(COUNT_STUDENTS, Integer.class);</span>
<span class="nc bnc" id="L165" title="All 2 branches missed.">        return count != null ? count : 0;</span>
    }

    /**
     * Initialize database tables (for development/testing)
     */
    public void initializeDatabase() {
<span class="nc" id="L172">        String createTableSQL = </span>
            &quot;CREATE TABLE IF NOT EXISTS students (&quot; +
            &quot;id BIGINT AUTO_INCREMENT PRIMARY KEY, &quot; +
            &quot;student_id VARCHAR(20) UNIQUE NOT NULL, &quot; +
            &quot;first_name VARCHAR(50) NOT NULL, &quot; +
            &quot;last_name VARCHAR(50) NOT NULL, &quot; +
            &quot;email VARCHAR(100) UNIQUE NOT NULL, &quot; +
            &quot;phone_number VARCHAR(20), &quot; +
            &quot;date_of_birth DATE, &quot; +
            &quot;program VARCHAR(100) NOT NULL, &quot; +
            &quot;year VARCHAR(10) NOT NULL, &quot; +
            &quot;status VARCHAR(20) DEFAULT 'ACTIVE', &quot; +
            &quot;enrollment_date DATE NOT NULL, &quot; +
            &quot;gpa DECIMAL(3,2) DEFAULT 0.00, &quot; +
            &quot;created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, &quot; +
            &quot;updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&quot; +
            &quot;)&quot;;

<span class="nc" id="L190">        jdbcTemplate.execute(createTableSQL);</span>
<span class="nc" id="L191">    }</span>

    /**
     * Insert sample data for testing
     */
    public void insertSampleData() {
        // Check if data already exists
<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (getStudentCount() &gt; 0) {</span>
<span class="nc" id="L199">            return;</span>
        }

<span class="nc" id="L202">        String[] sampleStudents = {</span>
            &quot;('XTU20250001', 'John', 'Doe', 'john.doe@xashytech.edu', '555-0101', '2003-05-15', 'Computer Science', '2', 'ACTIVE', '2023-09-01', 3.75)&quot;,
            &quot;('XTU20250002', 'Jane', 'Smith', 'jane.smith@xashytech.edu', '555-0102', '2002-08-22', 'Software Engineering', '3', 'ACTIVE', '2022-09-01', 3.92)&quot;,
            &quot;('XTU20250003', 'Mike', 'Johnson', 'mike.johnson@xashytech.edu', '555-0103', '2004-01-10', 'Cybersecurity', '1', 'ACTIVE', '2024-09-01', 3.45)&quot;,
            &quot;('XTU20250004', 'Sarah', 'Williams', 'sarah.williams@xashytech.edu', '555-0104', '2001-12-03', 'Data Science', '4', 'ACTIVE', '2021-09-01', 3.88)&quot;,
            &quot;('XTU20250005', 'David', 'Brown', 'david.brown@xashytech.edu', '555-0105', '2003-07-18', 'DevOps Engineering', '2', 'ACTIVE', '2023-09-01', 3.67)&quot;
        };

<span class="nc" id="L210">        String insertSampleSQL = </span>
            &quot;INSERT INTO students (student_id, first_name, last_name, email, phone_number, &quot; +
            &quot;date_of_birth, program, year, status, enrollment_date, gpa) VALUES &quot;;

<span class="nc bnc" id="L214" title="All 2 branches missed.">        for (String student : sampleStudents) {</span>
<span class="nc" id="L215">            jdbcTemplate.execute(insertSampleSQL + student);</span>
        }
<span class="nc" id="L217">    }</span>

    /**
     * Row mapper for Student objects
     */
    private static class StudentRowMapper implements RowMapper&lt;Student&gt; {
        @Override
        public Student mapRow(ResultSet rs, int rowNum) throws SQLException {
<span class="nc" id="L225">            Student student = new Student();</span>
<span class="nc" id="L226">            student.setId(rs.getLong(&quot;id&quot;));</span>
<span class="nc" id="L227">            student.setStudentId(rs.getString(&quot;student_id&quot;));</span>
<span class="nc" id="L228">            student.setFirstName(rs.getString(&quot;first_name&quot;));</span>
<span class="nc" id="L229">            student.setLastName(rs.getString(&quot;last_name&quot;));</span>
<span class="nc" id="L230">            student.setEmail(rs.getString(&quot;email&quot;));</span>
<span class="nc" id="L231">            student.setPhoneNumber(rs.getString(&quot;phone_number&quot;));</span>
            
<span class="nc" id="L233">            Date dateOfBirth = rs.getDate(&quot;date_of_birth&quot;);</span>
<span class="nc bnc" id="L234" title="All 2 branches missed.">            if (dateOfBirth != null) {</span>
<span class="nc" id="L235">                student.setDateOfBirth(dateOfBirth.toLocalDate());</span>
            }
            
<span class="nc" id="L238">            student.setProgram(rs.getString(&quot;program&quot;));</span>
<span class="nc" id="L239">            student.setYear(rs.getString(&quot;year&quot;));</span>
<span class="nc" id="L240">            student.setStatus(rs.getString(&quot;status&quot;));</span>
            
<span class="nc" id="L242">            Date enrollmentDate = rs.getDate(&quot;enrollment_date&quot;);</span>
<span class="nc bnc" id="L243" title="All 2 branches missed.">            if (enrollmentDate != null) {</span>
<span class="nc" id="L244">                student.setEnrollmentDate(enrollmentDate.toLocalDate());</span>
            }
            
<span class="nc" id="L247">            student.setGpa(rs.getDouble(&quot;gpa&quot;));</span>
<span class="nc" id="L248">            return student;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>