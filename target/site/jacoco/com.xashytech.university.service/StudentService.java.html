<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>StudentService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Xashy Tech University Student Portal</a> &gt; <a href="index.source.html" class="el_package">com.xashytech.university.service</a> &gt; <span class="el_source">StudentService.java</span></div><h1>StudentService.java</h1><pre class="source lang-java linenums">package com.xashytech.university.service;

import com.xashytech.university.dao.StudentDAO;
import com.xashytech.university.model.Student;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.stream.Collectors;

/**
 * Student Service Layer
 * Contains business logic for student operations
 */
@Service
<span class="fc" id="L16">public class StudentService {</span>

    @Autowired
    private StudentDAO studentDAO;

    /**
     * Get all students
     */
    public List&lt;Student&gt; getAllStudents() {
<span class="fc" id="L25">        return studentDAO.findAll();</span>
    }

    /**
     * Get student by ID
     */
    public Student getStudentById(Long id) {
<span class="fc" id="L32">        return studentDAO.findById(id);</span>
    }

    /**
     * Get student by student ID
     */
    public Student getStudentByStudentId(String studentId) {
<span class="nc" id="L39">        return studentDAO.findByStudentId(studentId);</span>
    }

    /**
     * Save new student
     */
    public Student saveStudent(Student student) {
        // Validate student data
<span class="fc bfc" id="L47" title="All 2 branches covered.">        if (!student.isValid()) {</span>
<span class="fc" id="L48">            throw new IllegalArgumentException(&quot;Student data is invalid&quot;);</span>
        }

        // Check if student ID already exists
<span class="fc bfc" id="L52" title="All 2 branches covered.">        if (studentDAO.findByStudentId(student.getStudentId()) != null) {</span>
<span class="fc" id="L53">            throw new IllegalArgumentException(&quot;Student ID already exists: &quot; + student.getStudentId());</span>
        }

        // Check if email already exists
<span class="fc bfc" id="L57" title="All 2 branches covered.">        if (studentDAO.findByEmail(student.getEmail()) != null) {</span>
<span class="fc" id="L58">            throw new IllegalArgumentException(&quot;Email already exists: &quot; + student.getEmail());</span>
        }

        // Generate student ID if not provided
<span class="pc bpc" id="L62" title="2 of 4 branches missed.">        if (student.getStudentId() == null || student.getStudentId().trim().isEmpty()) {</span>
<span class="nc" id="L63">            student.setStudentId(generateStudentId());</span>
        }

<span class="fc" id="L66">        return studentDAO.save(student);</span>
    }

    /**
     * Update existing student
     */
    public Student updateStudent(Student student) {
<span class="pc bpc" id="L73" title="1 of 2 branches missed.">        if (!student.isValid()) {</span>
<span class="nc" id="L74">            throw new IllegalArgumentException(&quot;Student data is invalid&quot;);</span>
        }

<span class="fc" id="L77">        Student existingStudent = studentDAO.findById(student.getId());</span>
<span class="fc bfc" id="L78" title="All 2 branches covered.">        if (existingStudent == null) {</span>
<span class="fc" id="L79">            throw new IllegalArgumentException(&quot;Student not found with ID: &quot; + student.getId());</span>
        }

        // Check if email is being changed and if it conflicts with another student
<span class="pc bpc" id="L83" title="1 of 2 branches missed.">        if (!existingStudent.getEmail().equals(student.getEmail())) {</span>
<span class="fc" id="L84">            Student emailConflict = studentDAO.findByEmail(student.getEmail());</span>
<span class="pc bpc" id="L85" title="3 of 4 branches missed.">            if (emailConflict != null &amp;&amp; !emailConflict.getId().equals(student.getId())) {</span>
<span class="nc" id="L86">                throw new IllegalArgumentException(&quot;Email already exists: &quot; + student.getEmail());</span>
            }
        }

<span class="fc" id="L90">        return studentDAO.update(student);</span>
    }

    /**
     * Delete student
     */
    public boolean deleteStudent(Long id) {
<span class="fc" id="L97">        Student student = studentDAO.findById(id);</span>
<span class="fc bfc" id="L98" title="All 2 branches covered.">        if (student == null) {</span>
<span class="fc" id="L99">            throw new IllegalArgumentException(&quot;Student not found with ID: &quot; + id);</span>
        }
<span class="fc" id="L101">        return studentDAO.delete(id);</span>
    }

    /**
     * Search students by name
     */
    public List&lt;Student&gt; searchStudentsByName(String searchTerm) {
<span class="fc" id="L108">        return getAllStudents().stream()</span>
<span class="fc" id="L109">                .filter(student -&gt; </span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">                    student.getFirstName().toLowerCase().contains(searchTerm.toLowerCase()) ||</span>
<span class="pc bpc" id="L111" title="1 of 2 branches missed.">                    student.getLastName().toLowerCase().contains(searchTerm.toLowerCase()) ||</span>
<span class="pc bpc" id="L112" title="1 of 2 branches missed.">                    student.getFullName().toLowerCase().contains(searchTerm.toLowerCase())</span>
                )
<span class="fc" id="L114">                .collect(Collectors.toList());</span>
    }

    /**
     * Get students by program
     */
    public List&lt;Student&gt; getStudentsByProgram(String program) {
<span class="fc" id="L121">        return getAllStudents().stream()</span>
<span class="fc" id="L122">                .filter(student -&gt; student.getProgram().equalsIgnoreCase(program))</span>
<span class="fc" id="L123">                .collect(Collectors.toList());</span>
    }

    /**
     * Get students by year
     */
    public List&lt;Student&gt; getStudentsByYear(String year) {
<span class="nc" id="L130">        return getAllStudents().stream()</span>
<span class="nc" id="L131">                .filter(student -&gt; student.getYear().equals(year))</span>
<span class="nc" id="L132">                .collect(Collectors.toList());</span>
    }

    /**
     * Get active students only
     */
    public List&lt;Student&gt; getActiveStudents() {
<span class="fc" id="L139">        return getAllStudents().stream()</span>
<span class="fc" id="L140">                .filter(Student::isActive)</span>
<span class="fc" id="L141">                .collect(Collectors.toList());</span>
    }

    /**
     * Get student statistics
     */
    public StudentStatistics getStatistics() {
<span class="fc" id="L148">        List&lt;Student&gt; allStudents = getAllStudents();</span>
        
<span class="fc" id="L150">        long totalStudents = allStudents.size();</span>
<span class="fc" id="L151">        long activeStudents = allStudents.stream().filter(Student::isActive).count();</span>
<span class="fc" id="L152">        long inactiveStudents = totalStudents - activeStudents;</span>
        
<span class="fc" id="L154">        double averageGpa = allStudents.stream()</span>
<span class="pc bpc" id="L155" title="2 of 4 branches missed.">                .filter(s -&gt; s.getGpa() != null &amp;&amp; s.getGpa() &gt; 0)</span>
<span class="fc" id="L156">                .mapToDouble(Student::getGpa)</span>
<span class="fc" id="L157">                .average()</span>
<span class="fc" id="L158">                .orElse(0.0);</span>

<span class="fc" id="L160">        return new StudentStatistics(totalStudents, activeStudents, inactiveStudents, averageGpa);</span>
    }

    /**
     * Generate a unique student ID
     */
    private String generateStudentId() {
<span class="nc" id="L167">        String prefix = &quot;XTU&quot;;</span>
<span class="nc" id="L168">        int year = java.time.LocalDate.now().getYear();</span>
<span class="nc" id="L169">        int sequence = getAllStudents().size() + 1;</span>
<span class="nc" id="L170">        return String.format(&quot;%s%d%04d&quot;, prefix, year, sequence);</span>
    }

    /**
     * Inner class for student statistics
     */
    public static class StudentStatistics {
        private final long totalStudents;
        private final long activeStudents;
        private final long inactiveStudents;
        private final double averageGpa;

<span class="fc" id="L182">        public StudentStatistics(long totalStudents, long activeStudents, long inactiveStudents, double averageGpa) {</span>
<span class="fc" id="L183">            this.totalStudents = totalStudents;</span>
<span class="fc" id="L184">            this.activeStudents = activeStudents;</span>
<span class="fc" id="L185">            this.inactiveStudents = inactiveStudents;</span>
<span class="fc" id="L186">            this.averageGpa = averageGpa;</span>
<span class="fc" id="L187">        }</span>

        // Getters
<span class="fc" id="L190">        public long getTotalStudents() { return totalStudents; }</span>
<span class="fc" id="L191">        public long getActiveStudents() { return activeStudents; }</span>
<span class="fc" id="L192">        public long getInactiveStudents() { return inactiveStudents; }</span>
<span class="fc" id="L193">        public double getAverageGpa() { return averageGpa; }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>